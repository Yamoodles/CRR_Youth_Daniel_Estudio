<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CRR Youth</title>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* General Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Fredoka', sans-serif;
            background: #deb887; /* Beige */
            min-height: 100vh;
            color: #2c1810; /* Dark Brown */
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Header */
        .header {
            text-align: center;
            margin-bottom: 40px;
            background: rgba(255, 255, 255, 0.9);
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }

        .header h1 {
            font-size: 3rem;
            font-weight: 700;
            color: #8b4513; /* Brown */
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
        }

        .header p {
            font-size: 1.2rem;
            color: #5d4037; /* Darker Brown */
            font-weight: 400;
        }

        /* Admin Button */
        .admin-button {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #ff8c00; /* Orange */
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            font-family: 'Fredoka', sans-serif;
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(255, 140, 0, 0.3);
            transition: all 0.3s ease;
            z-index: 1000;
        }

        .admin-button:hover {
            background: #e67e00; /* Darker Orange */
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 140, 0, 0.4);
        }

        /* Main Content Sections (Public View) */
        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 40px;
        }

        .section {
            background: rgba(255, 255, 255, 0.95);
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
        }

        .section:hover {
            transform: translateY(-5px);
        }

        .section h2 {
            font-size: 2rem;
            font-weight: 600;
            color: #8b4513; /* Brown */
            margin-bottom: 20px;
            border-bottom: 3px solid #ff8c00; /* Orange */
            padding-bottom: 10px;
        }

        /* Daniel Study Section Specifics */
        .daniel-study {
            grid-column: 1 / -1; /* Spans full width */
            margin-top: 20px;
        }

        .daniel-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .tab-button {
            background: #8b4513; /* Brown */
            border: none;
            padding: 12px 20px;
            border-radius: 15px;
            font-family: 'Fredoka', sans-serif;
            font-weight: 500;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s ease;
            color: white;
        }

        .tab-button.active {
            background: #ff8c00; /* Orange */
            color: white;
            transform: translateY(-2px);
        }

        .tab-button:hover {
            background: #ff8c00; /* Orange */
            color: white;
        }

        .tab-content {
            display: none;
            background: #f9f7f4; /* Beige/Off-white */
            padding: 20px;
            border-radius: 15px;
            border: 2px solid #8b4513; /* Brown */
        }

        .tab-content.active {
            display: block;
        }

        /* Content Items (Events, Flyers, Summaries, Questions) */
        .event-item, .flyer-item, .chapter-item, .question-item {
            background: #f9f7f4; /* Beige/Off-white */
            padding: 20px;
            margin-bottom: 15px;
            border-radius: 15px;
            border-left: 5px solid #ff8c00; /* Orange accent */
            transition: all 0.3s ease;
        }

        .event-item:hover, .flyer-item:hover, .chapter-item:hover, .question-item:hover {
            background: #f5f2ed; /* Slightly darker beige on hover */
            transform: translateX(5px);
        }

        .event-date {
            background: #ff8c00; /* Orange */
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-weight: 600;
            display: inline-block;
            margin-bottom: 10px;
            font-size: 0.9rem;
        }

        /* Flyer Image Styles */
        .flyer-item img {
            max-width: 100%;
            height: auto;
            display: block; /* Ensures image takes its own line */
            margin-top: 15px; /* Spacing between title/content and image */
            border-radius: 10px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }


        /* Modals */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 2000;
            backdrop-filter: blur(5px);
            overflow-y: auto; /* Allow scrolling for tall modals */
        }

        .modal-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 30px;
            border-radius: 20px;
            width: 90%;
            max-width: 500px;
            max-height: 90vh; /* Max height to fit on smaller screens */
            overflow-y: auto; /* Enable scrolling for modal content */
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        .modal h3 {
            color: #8b4513; /* Brown */
            margin-bottom: 20px;
            font-size: 1.5rem;
            text-align: center;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #5d4037; /* Darker Brown */
        }

        .form-group input, .form-group textarea, .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #8b4513; /* Brown */
            border-radius: 10px;
            font-family: 'Fredoka', sans-serif;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus, .form-group textarea:focus, .form-group select:focus {
            outline: none;
            border-color: #ff8c00; /* Orange */
        }

        .form-group textarea {
            resize: vertical;
            min-height: 100px;
        }

        .button-group {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-top: 20px;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 15px;
            font-family: 'Fredoka', sans-serif;
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: #ff8c00; /* Orange */
            color: white;
        }

        .btn-primary:hover {
            background: #e67e00; /* Darker Orange */
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: #8b4513; /* Brown */
            color: white;
        }

        .btn-secondary:hover {
            background: #6d3610; /* Darker Brown */
        }

        .btn-danger {
            background: #d32f2f; /* Red */
            color: white;
        }

        .btn-danger:hover {
            background: #b71c1c; /* Darker Red */
        }

        /* Admin Panel */
        .admin-panel {
            display: none; /* Controlled by JS */
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .admin-section {
            background: rgba(255, 255, 255, 0.95);
            padding: 25px;
            border-radius: 20px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        }

        .admin-section h3 {
            color: #8b4513; /* Brown */
            margin-bottom: 15px;
            font-size: 1.3rem;
        }

        .add-button {
            background: #4caf50; /* Green */
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 15px;
            font-family: 'Fredoka', sans-serif;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 15px;
        }

        .add-button:hover {
            background: #45a049; /* Darker Green */
            transform: translateY(-2px);
        }

        /* Admin List Items */
        .admin-item {
            background: #f9f7f4; /* Beige/Off-white */
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 10px;
            border-left: 4px solid #8b4513; /* Brown accent */
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap; /* Allow items to wrap on smaller screens */
            gap: 10px;
        }

        .admin-item span {
            flex-grow: 1;
            padding-right: 10px;
        }

        .delete-btn, .edit-btn {
            border: none;
            padding: 8px 12px;
            border-radius: 8px;
            font-family: 'Fredoka', sans-serif;
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.3s ease;
            white-space: nowrap; /* Prevent button text from wrapping */
        }

        .delete-btn {
            background: #d32f2f; /* Red */
            color: white;
            margin-left: 5px;
        }

        .delete-btn:hover {
            background: #b71c1c; /* Darker Red */
        }

        .edit-btn {
            background: #2196f3; /* Blue */
            color: white;
        }

        .edit-btn:hover {
            background: #1976d2; /* Darker Blue */
        }

        /* Quiz Specific Styles */
        .quiz-question {
            background: #fff;
            padding: 15px;
            margin: 10px 0;
            border-radius: 10px;
            border: 2px solid #8b4513; /* Brown */
        }

        .quiz-options {
            margin-top: 10px;
        }

        .quiz-option {
            display: block;
            margin: 5px 0;
            padding: 10px;
            background: #f9f7f4; /* Beige/Off-white */
            border-radius: 8px;
            cursor: pointer;
            transition: background 0.3s ease;
            border: 1px solid #ddd;
        }

        .quiz-option:hover {
            background: #ede8e0; /* Lighter hover for options */
        }

        .quiz-option input[type="radio"] {
            margin-right: 10px;
            transform: scale(1.2); /* Make radio buttons a bit bigger */
        }

        .quiz-submit-btn {
            margin-top: 20px;
            background: #4caf50;
            color: white;
            padding: 12px 25px;
            border: none;
            border-radius: 15px;
            font-family: 'Fredoka', sans-serif;
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .quiz-submit-btn:hover {
            background: #45a049;
            transform: translateY(-2px);
        }

        .quiz-result {
            margin-top: 10px;
            padding: 10px;
            border-radius: 8px;
            font-weight: 600;
            text-align: center;
        }

        .quiz-correct {
            background: #e8f5e9; /* Light Green */
            color: #2e7d32; /* Dark Green */
            border: 1px solid #4caf50;
        }

        .quiz-incorrect {
            background: #ffebee; /* Light Red */
            color: #c62828; /* Dark Red */
            border: 1px solid #f44336;
        }

        .no-content {
            text-align: center;
            color: #8b4513; /* Brown */
            font-style: italic;
            padding: 20px;
        }

        /* Back Button */
        .back-button {
            background: #8b4513; /* Brown */
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 15px;
            font-family: 'Fredoka', sans-serif;
            font-weight: 600;
            cursor: pointer;
            margin-bottom: 20px;
            transition: all 0.3s ease;
        }

        .back-button:hover {
            background: #6d3610; /* Darker Brown */
            transform: translateY(-2px);
        }

        /* Footer */
        .footer {
            text-align: center;
            padding: 20px;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 20px;
            margin-top: 40px;
            font-style: italic;
            color: #5d4037; /* Darker Brown */
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .daniel-tabs {
                flex-direction: column;
            }
            
            .admin-panel {
                grid-template-columns: 1fr;
            }
            
            .modal-content {
                width: 95%;
                padding: 20px;
            }

            .admin-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }

            .delete-btn, .edit-btn {
                width: 100%;
                text-align: center;
            }
        }
    </style>
</head>
<body>
    <button class="admin-button" onclick="showAdminLogin()">Admin</button>
    
    <div class="container">
        <div class="header">
            <h1>CRR Youth</h1>
            <p>Growing in Faith Together</p>
        </div>

        <div id="publicView">
            <div class="main-content">
                <div class="section">
                    <h2>Events / Announcements</h2> 
                    <div id="eventsList">
                        <p class="no-content">No upcoming events or announcements. Check back soon!</p>
                    </div>
                </div>

                <div class="section">
                    <h2>Flyers</h2>
                    <div id="flyersList">
                        <p class="no-content">No flyers. Check back soon!</p>
                    </div>
                </div>
            </div>

            <div class="section daniel-study">
                <h2>Book of Daniel Study - REMA Camp</h2>
                <div class="daniel-tabs">
                    <button class="tab-button active" onclick="showTab('summaries', this)">Chapter Summaries</button>
                    <button class="tab-button" onclick="showTab('questions', this)">Practice Questions</button>
                    <button class="tab-button" onclick="showTab('quizzes', this)">Bible Quizzes</button>
                </div>
                
                <div id="summaries" class="tab-content active">
                    <div id="summariesList">
                        <p class="no-content">No chapter summaries available yet.</p>
                    </div>
                </div>
                
                <div id="questions" class="tab-content">
                    <div id="questionsList">
                        <p class="no-content">No practice questions available yet.</p>
                    </div>
                </div>
                
                <div id="quizzes" class="tab-content">
                    <div id="quizzesList">
                        <p class="no-content">No quizzes available yet.</p>
                    </div>
                </div>
            </div>
        </div>

        <div id="adminView" style="display: none;">
            <button class="back-button" onclick="showPublicView()">Back to Public View</button>
            <div class="admin-panel">
                <div class="admin-section">
                    <h3>Manage Events / Announcements</h3>
                    <button class="add-button" onclick="showAddEventModal()">Add Event / Announcement</button>
                    <div id="adminEventsList"></div>
                </div>
                
                <div class="admin-section">
                    <h3>Manage Flyers</h3>
                    <button class="add-button" onclick="showAddFlyerModal()">Add Flyer</button>
                    <div id="adminFlyersList"></div>
                </div>
                
                <div class="admin-section">
                    <h3>Manage Chapter Summaries</h3>
                    <button class="add-button" onclick="showAddSummaryModal()">Add Summary</button>
                    <div id="adminSummariesList"></div>
                </div>
                
                <div class="admin-section">
                    <h3>Manage Practice Questions</h3>
                    <button class="add-button" onclick="showAddQuestionModal()">Add Question</button>
                    <div id="adminQuestionsList"></div>
                </div>
                
                <div class="admin-section">
                    <h3>Manage Quizzes</h3>
                    <button class="add-button" onclick="showAddQuizModal()">Add Quiz</button>
                    <div id="adminQuizzesList"></div>
                </div>
            </div>
        </div>

        <div class="footer">
            <p>Coded by yamoodles</p>
        </div>
    </div>

    <div id="adminLoginModal" class="modal">
        <div class="modal-content">
            <h3>Admin Access</h3>
            <div class="form-group">
                <label for="adminPasscode">Enter Passcode:</label>
                <input type="password" id="adminPasscode" placeholder="Enter passcode">
            </div>
            <div class="button-group">
                <button class="btn btn-primary" onclick="checkAdminPasscode()">Login</button>
                <button class="btn btn-secondary" onclick="closeModal('adminLoginModal')">Cancel</button>
            </div>
        </div>
    </div>

    <div id="addEventModal" class="modal">
        <div class="modal-content">
            <h3 id="eventModalTitle">Add New Event / Announcement</h3> 
            <input type="hidden" id="editEventId">
            <div class="form-group">
                <label for="eventTitle">Title:</label> 
                <input type="text" id="eventTitle" placeholder="Enter event or announcement title" required> 
            </div>
            <div class="form-group">
                <label for="eventDate">Date:</label> 
                <input type="date" id="eventDate" required>
            </div>
            <div class="form-group">
                <label for="eventTime">Time (Optional):</label> 
                <input type="time" id="eventTime">
            </div>
            <div class="form-group">
                <label for="eventDescription">Description:</label>
                <textarea id="eventDescription" placeholder="Enter event or announcement description"></textarea> 
            </div>
            <div class="button-group">
                <button class="btn btn-primary" onclick="saveEvent()">Save Event / Announcement</button> 
                <button class="btn btn-secondary" onclick="closeModal('addEventModal')">Cancel</button>
            </div>
        </div>
    </div>

    <div id="addFlyerModal" class="modal">
        <div class="modal-content">
            <h3 id="flyerModalTitle">Add New Flyer</h3>
            <input type="hidden" id="editFlyerId">
            <div class="form-group">
                <label for="flyerTitle">Flyer Title:</label>
                <input type="text" id="flyerTitle" placeholder="Enter flyer title" required>
            </div>
            <div class="form-group">
                <label for="flyerImage">Flyer Image (Optional):</label>
                <input type="file" id="flyerImage" accept="image/*">
            </div>
            <div class="form-group">
                <label for="flyerContent">Additional Content (Optional):</label>
                <textarea id="flyerContent" placeholder="Enter any additional text for the flyer"></textarea>
            </div>
            <div class="form-group">
                <label for="flyerDate">Date Posted:</label>
                <input type="date" id="flyerDate" required>
            </div>
            <div class="button-group">
                <button class="btn btn-primary" onclick="saveFlyer()">Save Flyer</button>
                <button class="btn btn-secondary" onclick="closeModal('addFlyerModal')">Cancel</button>
            </div>
        </div>
    </div>

    <div id="addSummaryModal" class="modal">
        <div class="modal-content">
            <h3 id="summaryModalTitle">Add Chapter Summary</h3>
            <input type="hidden" id="editSummaryId">
            <div class="form-group">
                <label for="summaryChapter">Chapter:</label>
                <select id="summaryChapter" required>
                    <option value="">Select Chapter</option>
                    <option value="1">Chapter 1</option>
                    <option value="2">Chapter 2</option>
                    <option value="3">Chapter 3</option>
                    <option value="4">Chapter 4</option>
                    <option value="5">Chapter 5</option>
                    <option value="6">Chapter 6</option>
                    <option value="7">Chapter 7</option>
                    <option value="8">Chapter 8</option>
                    <option value="9">Chapter 9</option>
                    <option value="10">Chapter 10</option>
                    <option value="11">Chapter 11</option>
                    <option value="12">Chapter 12</option>
                </select>
            </div>
            <div class="form-group">
                <label for="summaryTitle">Summary Title:</label>
                <input type="text" id="summaryTitle" placeholder="Enter summary title" required>
            </div>
            <div class="form-group">
                <label for="summaryContent">Summary Content:</label>
                <textarea id="summaryContent" placeholder="Enter chapter summary" rows="6"></textarea>
            </div>
            <div class="button-group">
                <button class="btn btn-primary" onclick="saveSummary()">Save Summary</button>
                <button class="btn btn-secondary" onclick="closeModal('addSummaryModal')">Cancel</button>
            </div>
        </div>
    </div>

    <div id="addQuestionModal" class="modal">
        <div class="modal-content">
            <h3 id="questionModalTitle">Add Practice Question</h3>
            <input type="hidden" id="editQuestionId">
            <div class="form-group">
                <label for="questionChapter">Chapter:</label>
                <select id="questionChapter" required>
                    <option value="">Select Chapter</option>
                    <option value="1">Chapter 1</option>
                    <option value="2">Chapter 2</option>
                    <option value="3">Chapter 3</option>
                    <option value="4">Chapter 4</option>
                    <option value="5">Chapter 5</option>
                    <option value="6">Chapter 6</option>
                    <option value="7">Chapter 7</option>
                    <option value="8">Chapter 8</option>
                    <option value="9">Chapter 9</option>
                    <option value="10">Chapter 10</option>
                    <option value="11">Chapter 11</option>
                    <option value="12">Chapter 12</option>
                </select>
            </div>
            <div class="form-group">
                <label for="questionText">Question:</label>
                <textarea id="questionText" placeholder="Enter practice question" rows="3" required></textarea>
            </div>
            <div class="form-group">
                <label for="questionAnswer">Answer:</label>
                <textarea id="questionAnswer" placeholder="Enter answer" rows="3" required></textarea>
            </div>
            <div class="button-group">
                <button class="btn btn-primary" onclick="saveQuestion()">Save Question</button>
                <button class="btn btn-secondary" onclick="closeModal('addQuestionModal')">Cancel</button>
            </div>
        </div>
    </div>

    <div id="addQuizModal" class="modal">
        <div class="modal-content">
            <h3 id="quizModalTitle">Add Quiz Question</h3>
            <input type="hidden" id="editQuizId">
            <div class="form-group">
                <label for="quizChapter">Chapter:</label>
                <select id="quizChapter" required>
                    <option value="">Select Chapter</option>
                    <option value="1">Chapter 1</option>
                    <option value="2">Chapter 2</option>
                    <option value="3">Chapter 3</option>
                    <option value="4">Chapter 4</option>
                    <option value="5">Chapter 5</option>
                    <option value="6">Chapter 6</option>
                    <option value="7">Chapter 7</option>
                    <option value="8">Chapter 8</option>
                    <option value="9">Chapter 9</option>
                    <option value="10">Chapter 10</option>
                    <option value="11">Chapter 11</option>
                    <option value="12">Chapter 12</option>
                </select>
            </div>
            <div class="form-group">
                <label for="quizQuestion">Question:</label>
                <textarea id="quizQuestion" placeholder="Enter quiz question" rows="3" required></textarea>
            </div>
            <div class="form-group">
                <label for="quizOptionA">Option A:</label>
                <input type="text" id="quizOptionA" placeholder="Enter option A" required>
            </div>
            <div class="form-group">
                <label for="quizOptionB">Option B:</label>
                <input type="text" id="quizOptionB" placeholder="Enter option B" required>
            </div>
            <div class="form-group">
                <label for="quizOptionC">Option C:</label>
                <input type="text" id="quizOptionC" placeholder="Enter option C" required>
            </div>
            <div class="form-group">
                <label for="quizOptionD">Option D:</label>
                <input type="text" id="quizOptionD" placeholder="Enter option D" required>
            </div>
            <div class="form-group">
                <label for="quizCorrectAnswer">Correct Answer:</label>
                <select id="quizCorrectAnswer" required>
                    <option value="">Select correct answer</option>
                    <option value="A">A</option>
                    <option value="B">B</option>
                    <option value="C">C</option>
                    <option value="D">D</option>
                </select>
            </div>
            <div class="button-group">
                <button class="btn btn-primary" onclick="saveQuiz()">Save Quiz</button>
                <button class="btn btn-secondary" onclick="closeModal('addQuizModal')">Cancel</button>
            </div>
        </div>
    </div>

    <script>
        // Data storage
        // We'll use localStorage for persistence.
        // Initialize with sample data if localStorage is empty.
        let siteData = loadDataFromLocalStorage();

        const ADMIN_PASSCODE = '899471'; // Defined as a constant for clarity

        // --- Data Persistence Functions ---
        function saveDataToLocalStorage() {
            try {
                localStorage.setItem('CRR_Youth_Site_Data', JSON.stringify(siteData));
                console.log("Data saved to Local Storage.");
            } catch (e) {
                console.error("Error saving to Local Storage:", e);
                alert("Error saving data. Local storage might be full or inaccessible.");
            }
        }

        function loadDataFromLocalStorage() {
            try {
                const storedData = localStorage.getItem('CRR_Youth_Site_Data');
                if (storedData) {
                    console.log("Data loaded from Local Storage.");
                    const parsedData = JSON.parse(storedData);
                    // Ensure all IDs are numbers, useful for strict comparisons
                    ['events', 'flyers', 'summaries', 'questions', 'quizzes'].forEach(type => {
                        if (parsedData[type]) {
                            parsedData[type] = parsedData[type].map(item => ({
                                ...item,
                                id: parseInt(item.id) // Ensure ID is an integer
                            }));
                        }
                    });
                    return parsedData;
                } else {
                    console.log("No data found in Local Storage. Loading sample data.");
                    return {
                        events: [
                            { id: 1, title: "Youth Service Night", date: "2025-07-15", time: "19:00", description: "Join us for an evening of worship and fellowship as we prepare for REMA camp." },
                            { id: 2, title: "REMA Camp Kick-off", date: "2025-07-20", time: "10:00", description: "Get ready for camp! Mandatory briefing for all attendees." }
                        ],
                        flyers: [
                            // Sample flyer with a placeholder image URL
                            { id: 1, title: "REMA Camp Registration", content: "Register now for REMA camp! Don't miss this amazing opportunity to grow in faith and fellowship. Deadline: July 10th.", image: "https://placehold.co/400x200/deb887/2c1810?text=REMA+Camp+Flyer", date: "2025-06-29" },
                            { id: 2, title: "Bible Study Schedule", content: "New Bible study schedule available for July. Pick up your copy at the info desk.", image: "https://placehold.co/400x150/ff8c00/ffffff?text=Bible+Study+Announcement", date: "2025-06-25" }
                        ],
                        summaries: [
                            { id: 1, chapter: "1", title: "Daniel's Faithfulness", content: "Daniel Chapter 1 introduces us to Daniel and his three friends who were taken captive to Babylon. Despite being in a foreign land, they remained faithful to God's laws and refused to defile themselves with the king's food. God blessed their faithfulness with wisdom and understanding." },
                            { id: 2, chapter: "2", title: "Nebuchadnezzar's Dream", content: "Chapter 2 describes King Nebuchadnezzar's troubling dream and his demand for his wise men to not only interpret it but also to tell him what he dreamed. Only Daniel, through God's revelation, was able to do so, revealing God's sovereignty over earthly kingdoms." }
                        ],
                        questions: [
                            { id: 1, chapter: "1", question: "What were the names of Daniel's three friends?", answer: "Hananiah, Mishael, and Azariah (later renamed Shadrach, Meshach, and Abednego)." },
                            { id: 2, chapter: "1", question: "Why did Daniel and his friends refuse the king's food and wine?", answer: "Because they did not want to defile themselves, possibly due to dietary laws or food offered to idols." },
                            { id: 3, chapter: "2", question: "What did King Nebuchadnezzar see in his dream?", answer: "A large, dazzling statue with a head of gold, chest and arms of silver, belly and thighs of bronze, legs of iron, and feet of iron and clay." }
                        ],
                        quizzes: [
                            { id: 1, chapter: "1", question: "How long did Daniel and his friends eat vegetables and water to test God?", options: { A: "7 days", B: "10 days", C: "14 days", D: "21 days" }, correctAnswer: "B" },
                            { id: 2, chapter: "2", question: "Who was able to interpret King Nebuchadnezzar's dream?", options: { A: "The wise men", B: "The magicians", C: "Daniel", D: "The king himself" }, correctAnswer: "C" }
                        ]
                    };
                }
            } catch (e) {
                console.error("Error loading from Local Storage:", e);
                alert("Error loading data. Your browser's local storage might be corrupted or inaccessible.");
                // Return default data in case of loading error
                return { events: [], flyers: [], summaries: [], questions: [], quizzes: [] };
            }
        }

        // --- Initialization ---
        document.addEventListener('DOMContentLoaded', init); // Ensure DOM is loaded before running init

        function init() {
            renderPublicContent();
        }

        // --- View Switching ---
        function showAdminLogin() {
            document.getElementById('adminPasscode').value = ''; // Clear passcode field
            document.getElementById('adminLoginModal').style.display = 'block';
        }

        function checkAdminPasscode() {
            const passcode = document.getElementById('adminPasscode').value;
            if (passcode === ADMIN_PASSCODE) {
                closeModal('adminLoginModal');
                showAdminView();
            } else {
                alert('Incorrect passcode!');
                document.getElementById('adminPasscode').value = ''; // Clear passcode on incorrect attempt
            }
        }

        function showAdminView() {
            document.getElementById('publicView').style.display = 'none';
            document.getElementById('adminView').style.display = 'block';
            document.querySelector('.admin-panel').style.display = 'grid'; // Ensure admin panel is displayed as grid
            renderAdminContent(); // Refresh admin lists
        }

        function showPublicView() {
            document.getElementById('adminView').style.display = 'none';
            document.getElementById('publicView').style.display = 'block';
            renderPublicContent(); // Refresh public lists
        }

        // --- Modal Functions ---
        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
            clearModalForms(); // Clear form fields when modal closes
            // Reset modal titles and hidden IDs when closing
            document.getElementById('eventModalTitle').textContent = 'Add New Event / Announcement';
            document.getElementById('editEventId').value = '';
            document.getElementById('flyerModalTitle').textContent = 'Add New Flyer';
            document.getElementById('editFlyerId').value = '';
            document.getElementById('summaryModalTitle').textContent = 'Add Chapter Summary';
            document.getElementById('editSummaryId').value = '';
            document.getElementById('questionModalTitle').textContent = 'Add Practice Question';
            document.getElementById('editQuestionId').value = '';
            document.getElementById('quizModalTitle').textContent = 'Add Quiz Question';
            document.getElementById('editQuizId').value = '';
        }

        function clearModalForms() {
            document.querySelectorAll('.modal-content input, .modal-content textarea, .modal-content select').forEach(field => {
                if (field.id !== 'adminPasscode') { // Don't clear admin passcode
                    field.value = '';
                }
            });
        }

        // --- Tab Switching Function ---
        function showTab(tabId, clickedButton) {
            // Deactivate all tab buttons
            document.querySelectorAll('.daniel-tabs .tab-button').forEach(button => {
                button.classList.remove('active');
            });

            // Deactivate all tab content
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });

            // Activate the clicked button and corresponding tab content
            clickedButton.classList.add('active');
            document.getElementById(tabId).classList.add('active');
        }

        // --- Generic Rendering Function ---
        function renderContent(elementId, dataArray, type, isAdmin) {
            const listElement = document.getElementById(elementId);
            listElement.innerHTML = ''; // Clear existing content

            if (dataArray.length === 0) {
                let noContentMsg = '';
                if (type === 'events') noContentMsg = 'No upcoming events or announcements. Check back soon!';
                else if (type === 'flyers') noContentMsg = 'No flyers. Check back soon!';
                else if (type === 'summaries') noContentMsg = 'No chapter summaries available yet.';
                else if (type === 'questions') noContentMsg = 'No practice questions available yet.';
                else if (type === 'quizzes') noContentMsg = 'No quizzes available yet.';
                listElement.innerHTML = `<p class="no-content">${noContentMsg}</p>`;
                return;
            }

            // Sort data based on type
            let sortedData = [...dataArray];
            if (type === 'events' || type === 'summaries' || type === 'questions' || type === 'quizzes') {
                sortedData.sort((a, b) => {
                    if (a.chapter && b.chapter) return parseInt(a.chapter) - parseInt(b.chapter);
                    if (a.date && b.date) return new Date(a.date) - new Date(b.date);
                    return 0; // No specific sort if no chapter/date
                });
            } else if (type === 'flyers') {
                sortedData.sort((a, b) => new Date(b.date) - new Date(a.date)); // Most recent first
            }

            sortedData.forEach(item => {
                const itemDiv = document.createElement('div');
                itemDiv.classList.add(isAdmin ? 'admin-item' : `${type.slice(0, -1)}-item`); // e.g., 'event-item' or 'admin-item'

                let contentHtml = '';
                if (type === 'events') {
                    const formattedDate = new Date(item.date).toLocaleDateString('en-US', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
                    contentHtml = `
                        <h3>${item.title}</h3>
                        <div class="event-date">${formattedDate} ${item.time ? 'at ' + item.time : ''}</div>
                        <p>${item.description || ''}</p>
                    `;
                } else if (type === 'flyers') {
                    let imageHtml = '';
                    if (item.image) {
                        imageHtml = `<img src="${item.image}" alt="${item.title}" loading="lazy" onerror="this.onerror=null;this.src='https://placehold.co/400x200/cccccc/333333?text=Image+Error';">`; // Added onerror for broken image links
                    }
                    contentHtml = `
                        <h3>${item.title}</h3>
                        <p>${item.content || ''}</p>
                        ${imageHtml}
                        <small>Posted: ${item.date}</small>
                    `;
                } else if (type === 'summaries') {
                    contentHtml = `
                        <h4>Chapter ${item.chapter}: ${item.title}</h4>
                        <p>${item.content || ''}</p>
                    `;
                } else if (type === 'questions') {
                    contentHtml = `
                        <p><strong>Q:</strong> ${item.question}</p>
                        <p><strong>A:</strong> ${item.answer}</p>
                    `;
                } else if (type === 'quizzes') {
                    if (isAdmin) {
                        contentHtml = `
                            <strong>Ch ${item.chapter} Quiz:</strong> ${item.question.substring(0, 50)}...<br>
                            Options: A) ${item.options.A}, B) ${item.options.B}, C) ${item.options.C}, D) ${item.options.D}<br>
                            Correct: ${item.correctAnswer}
                        `;
                    } else {
                        contentHtml = `
                            <div class="quiz-question">
                                <h3>Chapter ${item.chapter} Quiz:</h3>
                                <p>${item.question}</p>
                                <div class="quiz-options">
                                    ${Object.keys(item.options).map(key => `
                                        <label class="quiz-option">
                                            <input type="radio" name="quiz-${item.id}" value="${key}">
                                            ${key}. ${item.options[key]}
                                        </label>
                                    `).join('')}
                                </div>
                                <button class="quiz-submit-btn" onclick="checkQuizAnswer(${item.id})">Check Answer</button>
                                <div id="quizResult-${item.id}" class="quiz-result"></div>
                            </div>
                        `;
                    }
                }

                if (isAdmin) {
                    let singularType = type.slice(0, -1); // Default: remove 's'
                    if (type === 'summaries') {
                        singularType = 'summary';
                    } else if (type === 'quizzes') {
                        singularType = 'quiz';
                    }
                    const functionNameBase = singularType.charAt(0).toUpperCase() + singularType.slice(1);

                    itemDiv.innerHTML = `
                        <span>${contentHtml}</span>
                        <div>
                            <button class="edit-btn" onclick="edit${functionNameBase}(${item.id})">Edit</button>
                            <button class="delete-btn" onclick="delete${functionNameBase}(${item.id})">Delete</button>
                        </div>
                    `;
                } else {
                    itemDiv.innerHTML = contentHtml;
                }
                listElement.appendChild(itemDiv);
            });
        }

        // --- Public Content Rendering ---
        function renderPublicContent() {
            renderContent('eventsList', siteData.events, 'events', false);
            renderContent('flyersList', siteData.flyers, 'flyers', false);
            renderContent('summariesList', siteData.summaries, 'summaries', false);
            renderContent('questionsList', siteData.questions, 'questions', false);
            renderContent('quizzesList', siteData.quizzes, 'quizzes', false);
        }

        // --- Admin Content Rendering ---
        function renderAdminContent() {
            renderContent('adminEventsList', siteData.events, 'events', true);
            renderContent('adminFlyersList', siteData.flyers, 'flyers', true);
            renderContent('adminSummariesList', siteData.summaries, 'summaries', true);
            renderContent('adminQuestionsList', siteData.questions, 'questions', true);
            renderContent('adminQuizzesList', siteData.quizzes, 'quizzes', true);
        }

        // --- Quiz Taking Functionality ---
        function checkQuizAnswer(quizId) {
            const quiz = siteData.quizzes.find(q => q.id === quizId);
            if (!quiz) return;

            const selectedOption = document.querySelector(`input[name="quiz-${quizId}"]:checked`);
            const resultDiv = document.getElementById(`quizResult-${quiz.id}`);

            if (!selectedOption) {
                resultDiv.innerHTML = 'Please select an answer.';
                resultDiv.className = 'quiz-result quiz-incorrect';
                return;
            }

            if (selectedOption.value === quiz.correctAnswer) {
                resultDiv.innerHTML = 'Correct! Well done!';
                resultDiv.className = 'quiz-result quiz-correct';
            } else {
                resultDiv.innerHTML = `Incorrect. The correct answer was ${quiz.correctAnswer}.`;
                resultDiv.className = 'quiz-result quiz-incorrect';
            }
        }

        // --- Helper function to generate unique IDs ---
        function generateUniqueId(type) {
            const existingIds = siteData[type].map(item => item.id);
            return existingIds.length > 0 ? Math.max(...existingIds) + 1 : 1;
        }

        // --- CRUD Operations for Events ---
        function showAddEventModal() {
            document.getElementById('eventModalTitle').textContent = 'Add New Event / Announcement';
            document.getElementById('editEventId').value = '';
            document.getElementById('eventTitle').value = '';
            document.getElementById('eventDate').value = '';
            document.getElementById('eventTime').value = '';
            document.getElementById('eventDescription').value = '';
            document.getElementById('addEventModal').style.display = 'block';
        }

        function saveEvent() {
            const id = document.getElementById('editEventId').value;
            const title = document.getElementById('eventTitle').value;
            const date = document.getElementById('eventDate').value;
            const time = document.getElementById('eventTime').value;
            const description = document.getElementById('eventDescription').value;

            if (!title || !date) {
                alert('Please enter event title and date.');
                return;
            }

            if (id) {
                const eventIndex = siteData.events.findIndex(e => e.id == id);
                if (eventIndex > -1) {
                    siteData.events[eventIndex] = { id: parseInt(id), title, date, time, description };
                }
            } else {
                const newId = generateUniqueId('events');
                siteData.events.push({ id: newId, title, date, time, description });
            }
            saveDataToLocalStorage();
            renderAdminContent(); // Re-render both admin and public views after save
            closeModal('addEventModal');
            alert('Event / Announcement saved successfully!');
        }

        function editEvent(id) {
            const event = siteData.events.find(e => e.id === id);
            if (event) {
                document.getElementById('eventModalTitle').textContent = 'Edit Event / Announcement';
                document.getElementById('editEventId').value = event.id;
                document.getElementById('eventTitle').value = event.title;
                document.getElementById('eventDate').value = event.date;
                document.getElementById('eventTime').value = event.time;
                document.getElementById('eventDescription').value = event.description;
                document.getElementById('addEventModal').style.display = 'block';
            }
        }

        function deleteEvent(id) {
            if (confirm('Are you sure you want to delete this event / announcement?')) {
                siteData.events = siteData.events.filter(event => event.id !== id);
                saveDataToLocalStorage();
                renderAdminContent(); // Re-render both admin and public views
                alert('Event / Announcement deleted successfully!');
            }
        }

        // --- CRUD Operations for Flyers ---
        function showAddFlyerModal() {
            document.getElementById('flyerModalTitle').textContent = 'Add New Flyer';
            document.getElementById('editFlyerId').value = '';
            document.getElementById('flyerTitle').value = '';
            document.getElementById('flyerContent').value = '';
            document.getElementById('flyerImage').value = ''; // Clear file input
            document.getElementById('flyerDate').value = new Date().toISOString().split('T')[0]; // Default to today's date
            document.getElementById('addFlyerModal').style.display = 'block';
        }

        async function saveFlyer() { // Made async to handle file reading
            const id = document.getElementById('editFlyerId').value;
            const title = document.getElementById('flyerTitle').value;
            const content = document.getElementById('flyerContent').value;
            const date = document.getElementById('flyerDate').value;
            const imageFile = document.getElementById('flyerImage').files[0];

            if (!title || !date) {
                alert('Please enter flyer title and date posted.');
                return;
            }

            let imageData = '';
            if (imageFile) {
                try {
                    imageData = await readFileAsBase64(imageFile); // Read file as Base64
                } catch (e) {
                    console.error("Error reading image file:", e);
                    alert("Could not read image file. Please try a different image or format.");
                    return;
                }
            } else if (id) {
                // If editing and no new file selected, retain existing image data
                const existingFlyer = siteData.flyers.find(f => f.id == id);
                if (existingFlyer) {
                    imageData = existingFlyer.image;
                }
            }

            if (id) {
                const flyerIndex = siteData.flyers.findIndex(f => f.id == id);
                if (flyerIndex > -1) {
                    siteData.flyers[flyerIndex] = { id: parseInt(id), title, content, image: imageData, date };
                }
            } else {
                const newId = generateUniqueId('flyers');
                siteData.flyers.push({ id: newId, title, content, image: imageData, date });
            }
            saveDataToLocalStorage();
            renderAdminContent(); // Re-render both admin and public views
            closeModal('addFlyerModal');
            alert('Flyer saved successfully!');
        }

        function editFlyer(id) {
            const flyer = siteData.flyers.find(f => f.id === id);
            if (flyer) {
                document.getElementById('flyerModalTitle').textContent = 'Edit Flyer';
                document.getElementById('editFlyerId').value = flyer.id;
                document.getElementById('flyerTitle').value = flyer.title;
                document.getElementById('flyerContent').value = flyer.content;
                document.getElementById('flyerDate').value = flyer.date;
                document.getElementById('flyerImage').value = ''; // Clear file input, user can select new or leave empty
                document.getElementById('addFlyerModal').style.display = 'block';
            }
        }

        function deleteFlyer(id) {
            if (confirm('Are you sure you want to delete this flyer?')) {
                siteData.flyers = siteData.flyers.filter(flyer => flyer.id !== id);
                saveDataToLocalStorage();
                renderAdminContent(); // Re-render both admin and public views
                alert('Flyer deleted successfully!');
            }
        }

        // --- Helper function to read file as Base64 ---
        function readFileAsBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = () => resolve(reader.result);
                reader.onerror = error => reject(error);
                reader.readAsDataURL(file);
            });
        }

        // --- CRUD Operations for Summaries ---
        function showAddSummaryModal() {
            document.getElementById('summaryModalTitle').textContent = 'Add Chapter Summary';
            document.getElementById('editSummaryId').value = '';
            document.getElementById('summaryChapter').value = '';
            document.getElementById('summaryTitle').value = '';
            document.getElementById('summaryContent').value = '';
            document.getElementById('addSummaryModal').style.display = 'block';
        }

        function saveSummary() {
            const id = document.getElementById('editSummaryId').value;
            const chapter = document.getElementById('summaryChapter').value;
            const title = document.getElementById('summaryTitle').value;
            const content = document.getElementById('summaryContent').value;

            if (!chapter || !title || !content) {
                alert('Please fill in all summary fields.');
                return;
            }

            if (id) {
                const summaryIndex = siteData.summaries.findIndex(s => s.id == id);
                if (summaryIndex > -1) {
                    siteData.summaries[summaryIndex] = { id: parseInt(id), chapter, title, content };
                }
            } else {
                const newId = generateUniqueId('summaries');
                siteData.summaries.push({ id: newId, chapter, title, content });
            }
            saveDataToLocalStorage();
            renderAdminContent();
            closeModal('addSummaryModal');
            alert('Chapter summary saved successfully!');
        }

        function editSummary(id) {
            const summary = siteData.summaries.find(s => s.id === id);
            if (summary) {
                document.getElementById('summaryModalTitle').textContent = 'Edit Chapter Summary';
                document.getElementById('editSummaryId').value = summary.id;
                document.getElementById('summaryChapter').value = summary.chapter;
                document.getElementById('summaryTitle').value = summary.title;
                document.getElementById('summaryContent').value = summary.content;
                document.getElementById('addSummaryModal').style.display = 'block';
            }
        }

        function deleteSummary(id) {
            if (confirm('Are you sure you want to delete this summary?')) {
                siteData.summaries = siteData.summaries.filter(summary => summary.id !== id);
                saveDataToLocalStorage();
                renderAdminContent();
                alert('Summary deleted successfully!');
            }
        }

        // --- CRUD Operations for Questions ---
        function showAddQuestionModal() {
            document.getElementById('questionModalTitle').textContent = 'Add Practice Question';
            document.getElementById('editQuestionId').value = '';
            document.getElementById('questionChapter').value = '';
            document.getElementById('questionText').value = '';
            document.getElementById('questionAnswer').value = '';
            document.getElementById('addQuestionModal').style.display = 'block';
        }

        function saveQuestion() {
            const id = document.getElementById('editQuestionId').value;
            const chapter = document.getElementById('questionChapter').value;
            const questionText = document.getElementById('questionText').value;
            const questionAnswer = document.getElementById('questionAnswer').value;

            if (!chapter || !questionText || !questionAnswer) {
                alert('Please fill in all question fields.');
                return;
            }

            if (id) {
                const questionIndex = siteData.questions.findIndex(q => q.id == id);
                if (questionIndex > -1) {
                    siteData.questions[questionIndex] = { id: parseInt(id), chapter, question: questionText, answer: questionAnswer };
                }
            } else {
                const newId = generateUniqueId('questions');
                siteData.questions.push({ id: newId, chapter, question: questionText, answer: questionAnswer });
            }
            saveDataToLocalStorage();
            renderAdminContent();
            closeModal('addQuestionModal');
            alert('Practice question saved successfully!');
        }

        function editQuestion(id) {
            const question = siteData.questions.find(q => q.id === id);
            if (question) {
                document.getElementById('questionModalTitle').textContent = 'Edit Practice Question';
                document.getElementById('editQuestionId').value = question.id;
                document.getElementById('questionChapter').value = question.chapter;
                document.getElementById('questionText').value = question.question;
                document.getElementById('questionAnswer').value = question.answer;
                document.getElementById('addQuestionModal').style.display = 'block';
            }
        }

        function deleteQuestion(id) {
            if (confirm('Are you sure you want to delete this question?')) {
                siteData.questions = siteData.questions.filter(question => question.id !== id);
                saveDataToLocalStorage();
                renderAdminContent();
                alert('Question deleted successfully!');
            }
        }

        // --- CRUD Operations for Quizzes ---
        function showAddQuizModal() {
            document.getElementById('quizModalTitle').textContent = 'Add Quiz Question';
            document.getElementById('editQuizId').value = '';
            document.getElementById('quizChapter').value = '';
            document.getElementById('quizQuestion').value = '';
            document.getElementById('quizOptionA').value = '';
            document.getElementById('quizOptionB').value = '';
            document.getElementById('quizOptionC').value = '';
            document.getElementById('quizOptionD').value = '';
            document.getElementById('quizCorrectAnswer').value = '';
            document.getElementById('addQuizModal').style.display = 'block';
        }

        function saveQuiz() {
            const id = document.getElementById('editQuizId').value;
            const chapter = document.getElementById('quizChapter').value;
            const question = document.getElementById('quizQuestion').value;
            const optionA = document.getElementById('quizOptionA').value;
            const optionB = document.getElementById('quizOptionB').value;
            const optionC = document.getElementById('quizOptionC').value;
            const optionD = document.getElementById('quizOptionD').value;
            const correctAnswer = document.getElementById('quizCorrectAnswer').value;

            if (!chapter || !question || !optionA || !optionB || !optionC || !optionD || !correctAnswer) {
                alert('Please fill in all quiz fields.');
                return;
            }

            const options = { A: optionA, B: optionB, C: optionC, D: optionD };

            if (id) {
                const quizIndex = siteData.quizzes.findIndex(q => q.id == id);
                if (quizIndex > -1) {
                    siteData.quizzes[quizIndex] = { id: parseInt(id), chapter, question, options, correctAnswer };
                }
            } else {
                const newId = generateUniqueId('quizzes');
                siteData.quizzes.push({ id: newId, chapter, question, options, correctAnswer });
            }
            saveDataToLocalStorage();
            renderAdminContent();
            closeModal('addQuizModal');
            alert('Quiz question saved successfully!');
        }

        function editQuiz(id) {
            const quiz = siteData.quizzes.find(q => q.id === id);
            if (quiz) {
                document.getElementById('quizModalTitle').textContent = 'Edit Quiz Question';
                document.getElementById('editQuizId').value = quiz.id;
                document.getElementById('quizChapter').value = quiz.chapter;
                document.getElementById('quizQuestion').value = quiz.question;
                document.getElementById('quizOptionA').value = quiz.options.A;
                document.getElementById('quizOptionB').value = quiz.options.B;
                document.getElementById('quizOptionC').value = quiz.options.C;
                document.getElementById('quizOptionD').value = quiz.options.D;
                document.getElementById('quizCorrectAnswer').value = quiz.correctAnswer;
                document.getElementById('addQuizModal').style.display = 'block';
            }
        }

        function deleteQuiz(id) {
            if (confirm('Are you sure you want to delete this quiz question?')) {
                siteData.quizzes = siteData.quizzes.filter(quiz => quiz.id !== id);
                saveDataToLocalStorage();
                renderAdminContent();
                alert('Quiz question deleted successfully!');
            }
        }

    </script>
</body>
</html>